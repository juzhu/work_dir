<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>聚箸</title>
    <link rel="stylesheet" href="/stylesheets/weui.css"/>
    <link rel="stylesheet" href="/stylesheets/juzhu_shop.css"/>
    <link rel="stylesheet" href="/stylesheets/example.css"/>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
  </head>
  <body style="overflow-y:hidden ">
    {{#prodInfo}}
    <!-- 商品头部大图 -->
    <div class='juzhu_banner'>
      <img src='/images/{{detail_pic}}'>
    </div>


    <div class='jifen_prod_detail'>
      <div class='jifen_prod_title'>
        <p>{{prodName}}</p>
      </div>
      <div class='jifen_prod_info'>
        <span class='info_sale'>月售{{sales}}份</span>
        <!--<span class ='info-evaluate'>好评 100%</span>-->
      </div>
      <div class="info-price">
        <span class="info_price_new">积分: <span id="prod_price">{{jifen_price}}</span>
          <del class="info_price_old">积分: 200</del>
        </div>
        <div class='choose_info'>
          <p class="choose_info_text">兑换份数: </p>
          <div class='choose_btn'>
            <button id='btn_add'>+</button>
            <input class='prod_input' id='input_pro_num' tyep='text' value=1 />
            <button id='btn_min'>-</button>
          </div>
        </div>
        <div class='choose_info'>
          <div class='choose_result_text'>所需积分:</div>
          <div class='choose_result' id='choose_result'>100</div>
        </div>

        <div class="btn_pos">
          <a href="javascript:preOrder();" class="weui_btn weui_btn_primary">我要兑换</a>
        </div>

        <div class='prod_info_section'>
          <div class="prod_info_title_name">原料介绍</div>
          <div class="prod_info_title_line"></div>
          <div class="prod_info_content">
            <p>{{material_info}}</p>
          </div>
        </div>
        <div class='prod_info_section'>
          <div class="prod_info_title_name">制作流程</div>
          <div class="prod_info_title_line"></div>
          <div class="prod_info_content">
            <p>{{recipe}}</p>
          </div>
        </div>
        <div class='prod_info_section'>
          <div class="prod_info_title_name">其他说明</div>
          <div class="prod_info_title_line"></div>
          <div class="prod_info_content">
            <p>{{prod_comment}}</p>
          </div>
        </div>
      </div>
      {{/prodInfo}}
      <!-- 购买确认弹窗 -->
      <div class="weui_dialog_confirm" id="dialog_comfirm" style="display: none;">
        <div class="weui_mask"></div>
        <div class="weui_dialog">
          <div class="weui_dialog_hd"><strong class="weui_dialog_title">兑换确认</strong></div>
          <div class="weui_dialog_bd">兑换成功之后可在各大平台下单时候备注微信兑换产品，或下单之后联系客服给您配送哦</div>
          <div class="weui_dialog_ft">
            <a href="javascript:;" class="weui_btn_dialog cancel default">取消</a>
            <a href="javascript:;" class="weui_btn_dialog comfirm">确定</a>
          </div>
        </div>
      </div>
      <!--BEGIN toast-->
      <div id="toast" style="display: none;">
        <div class="weui_mask_transparent"></div>
        <div class="weui_toast">
          <i class="weui_icon_toast"></i>
          <p class="weui_toast_content">已完成</p>
        </div>
      </div>
      <!--end toast-->

      <!-- loading toast -->
      <div id="loadingToast" class="weui_loading_toast" style="display:none;">
        <div class="weui_mask_transparent"></div>
        <div class="weui_toast">
          <div class="weui_loading">
            <div class="weui_loading_leaf weui_loading_leaf_0"></div>
            <div class="weui_loading_leaf weui_loading_leaf_1"></div>
            <div class="weui_loading_leaf weui_loading_leaf_2"></div>
            <div class="weui_loading_leaf weui_loading_leaf_3"></div>
            <div class="weui_loading_leaf weui_loading_leaf_4"></div>
            <div class="weui_loading_leaf weui_loading_leaf_5"></div>
            <div class="weui_loading_leaf weui_loading_leaf_6"></div>
            <div class="weui_loading_leaf weui_loading_leaf_7"></div>
            <div class="weui_loading_leaf weui_loading_leaf_8"></div>
            <div class="weui_loading_leaf weui_loading_leaf_9"></div>
            <div class="weui_loading_leaf weui_loading_leaf_10"></div>
            <div class="weui_loading_leaf weui_loading_leaf_11"></div>
          </div>
          <p class="weui_toast_content">数据加载中</p>
        </div>
      </div>
      <script>
        var userPoint = "{{userInfo.point}}"
        var userAddr = "{{userInfo.user_addr}}"

        var cur_num = parseInt($("#input_pro_num").val());
        $("#choose_result").text(cur_num * parseInt($("#prod_price").text()));
        $("#btn_min").click(function() {
          var cur_num = parseInt($("#input_pro_num").val());
          if (cur_num > 1) {
            cur_num = cur_num - 1;
            $("#input_pro_num").val(cur_num);
            var needPoint = cur_num * parseInt($("#prod_price").text());
            if (needPoint <= userPoint) {
              $("#choose_result").text(cur_num * parseInt($("#prod_price").text()));
            }
          }
          });
          $("#btn_add").click(function() {
            var cur_num = parseInt($("#input_pro_num").val());
            if (cur_num < 5) {
              cur_num = cur_num + 1;
              $("#input_pro_num").val(cur_num);
              $("#choose_result").text(cur_num * parseInt($("#prod_price").text()));
            }
            });
            function preOrder() {
              // 检查本地积分余额
              $("#dialog_comfirm").show().on("click", ".weui_btn_dialog.comfirm", function() {
                $("#dialog_comfirm").off("click").hide();
                $('#loadingToast').show();
                $.get("/prodConfirm/" + {{prodInfo.prod_id}} + "/" + parseInt($("#input_pro_num").val()), function(err, ret) {
                  $('#loadingToast').hide();
                  $('#toast').show();
                  setTimeout(function () {
                    $('#toast').hide();
                    window.location.href = "/point";
                    }, 2000);
                  });
                  // window.location.href = "/prodConfirm/" + {{prodInfo.prod_id}} + "/" + parseInt($("#input_pro_num").val());
                }).on("click", ".weui_btn_dialog.cancel", function() {
                  $("#dialog_comfirm").off("click").hide();
                })
              }

              function newOrder() {
              }
            </script>
          </body>
        </html>

