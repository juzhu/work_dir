<div class="row-fluid">
  <div class="box">
    <div class="box-header">
      <h2><i class="icon-list-alt"></i><span class="break"></span>订单筛选</h2>
      <div class="box-icon">
        <a href="#" class="btn-minimize"><i class="icon-chevron-up"></i></a>
        <a href="#" class="btn-close"><i class="icon-remove"></i></a>
      </div>
    </div>
    <div class="box-content">
      <div class="center" style="min-width: 310px; height: 40px; margin: 0 auto">
        <div class="controls" style="float:left;"> 排序条件
          <select id="select_orderby">
            <option value="total_order_num" />总订餐次数
            <option value="last_order_time" />最后一次订餐时间
            <option value="first_order_time" />最开始一次订餐时间
          </select>
          <select id="select_order">
            <option value="desc" />降序
            <option value="asc" />升序
          </select>
        </div>
        <div class="controls" style="float:left;margin-left:30px;">
          <button id='query_order' type="submit" class="btn btn-primary">查询</button>
        </div>
      </div>
      <br>
      <span>用户数:{{items_len}}</span>
      <br>
    </div>
  </div>
  <div class="row-fluid">
    <div class="box span12">
      <div class="box-header">
        <h2><i class="icon-align-justify"></i><span class="break"></span>用户信息</h2>
        <div class="box-icon">
          <a href="#" class="btn-minimize"><i class="icon-chevron-up"></i></a>
          <a href="#" class="btn-close"><i class="icon-remove"></i></a>
        </div>
      </div>
      <div class="box-content">
        <table class="table table-bordered table-striped table-condensed">
          <thead>
            <tr uid={{uid}}>
              <th>客户名称</th>
              <th>性别</th>
              <th>电话</th>
              <th>地址</th>
              <th>分店</th>
              <th>历史订单数</th>
              <th>第一次下单时间</th>
              <th>最后一次下单时间</th>
              <th>累积消费金额</th>
              <th>客户均价</th>
              <th>备注</th>
              <th>客户微信</th>
              <th>设置</th>
            </tr>
          </thead>
          <tbody>
            {{#each items}}
            <tr>
              <td class="center" style='width:100px'>{{user_name}}</td>
              <td class="center">{{sex}}</td>
              <td class="center"><a href="/user_order/{{phone}}" style="color: #045e9f"> {{phone}} </a></td>
              <td class="center" style='width:200px'>{{user_addr}}</td>
              {{#if_eq store_id 1}}
              <td class="center" style='width:10%'>前进店</td>
              {{/if_eq}}
              {{#if_eq store_id 2}}
              <td class="center" style='width:10%'>坪洲店</td>
              {{/if_eq}}
              {{#if_eq store_id 3}}
              <td class="center" style='width:10%'>前进店 坪洲店</td>
              {{/if_eq}}

              <td class="center">{{total_order_num}}</td>
              <td class="center">{{first_order_day}}</td>
              <td class="center">{{last_order_day}}</td>
              <td class="center">{{accumulate_amount}}</td>
              <td class="center">{{avg_amount}}</td>
              <td class="center" style='width:100px'>{{comment}}</td>
              <td class="center" style='width:100px'>{{wechat_name}}</td>
              <td class="center" style='width:100px'>
                <button class="button blue" onclick="setUserWeChat(this, {{uid}})" width="110px;">客户微信号</button>
              </td>
            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>
    </div><!--/span-->
  </div><!--/row-->

  <script type="text/javascript">
    function setUserWeChat(ele, uid) {
      alert($(ele).text());
      var name=prompt("输入客户微信号","");
      $.get("/set_wechat_name/" + uid + "/" + name, function(data, err) {
        if (err == "success" && data["error"] == false) {
        alert("修改成功")
        $(ele).parent().prev().text(name);
        } else {
        alert("修改失败")
        }
        });
    }

var orderby = "{{orderby}}";
var order = "{{order}}";

$('#select_orderby').val(orderby);
$('#select_order').val(order);

/*
   $('#select_orderby').change(function() {
   orderby = $('#select_orderby').val();
   var url = '/userwithorder/' + orderby + "/desc";
   window.location.href = url;
   });
 */

$('#query_order').click(function(){
  orderby = $('#select_orderby').val();
  order = $('#select_order').val();
  var url = '/userwithorder/' + orderby + "/" + order;
  window.location.href = url;
  });

</script>
